<?xml version="1.0"?>

<!--
Command file contains an outer <videomonkey> element with one of each children:

 <default_device> - parameters used by any device when not overridden, with children:
     <quality> - set of stops for quality slider, with children:
         <quality_stop> - one quality stop, with attributes:
             which - index of this quality stop (0-5)
                 Quality stop 0 is untitled and is used to hold lowest values for slider.
                 Quality stop 5 is the rightmost tick mark and holds the highest slider values.
             title - the title of the tick mark
             bitrate - highest bitrate for this tick mark (or minimum bitrate when which=0)
             audio - audio quality: low (16k, 1ch, 11025), medium (32k, 1ch, 22050), high (128k, 2ch, 48000)
             size - relative video size (e.g., 0.5 is half size horiz and vert)

     <performance> - values for performance menu, with children:
         <performance_item> - one item in menu, with attributes and children:
             title - title of this item in menu
             <param> - a param (in runtime param dictionary) to use when this item is selected, with atributes:
                 id - name of this param
                 value - string value of this param (can use $ and ! as in commands)

     <script>
	
     <param> - see above. Param to use if none of the same name is given in device spec.

     <command> - command string, contained text is the string of the command, with attributes:
             id - name of the command (referenced by other commands)

 <devices> - List of devices in device menu, with children:
     <device_group> - A grouping of devices. Each groups has a title and groups are separated by a line, 
	                  with attributes and children:
         title - title for this group
         <common_device> - features common to all devices in this group, with same children as <default_device>
         <device> - device in this group, with same children as <default_device> and additional attributes and children:
             title - title for this device
             icon - name of the icon image to use for this device
             enabled - whether or not this device is enabled in the device list (true | false)
             <checkbox> - this describes a checkbox, with attributes and children:
                 which - which checkbox (0-n)
                 title - title on the checkbox
                 enabled - whether or not this checkbox is enabled (true | false)
                 <checked_params> - parameters used when this checkbox is checked, with children:
	                 <script>
	                 <param>
	                 <command>
                 <unchecked_params> - parameters used when this checkbox is not checked, with children:
	                 <script>
	                 <param>
	                 <command>
             <menu> - this describes a menu, with children:
                 which - which menu (0-n)
                 title - title on the menu
                 enabled - whether or not this menu is enabled (true | false)
                 <menu_item> - one entry in the menu, with attributes and children:
	                 title - title of this menu item
	                 <script>
	                 <param>
	                 <command>
                 <unchecked_params> - parameters used when this checkbox is not checked, with children:
	                 <script>
	                 <param>
	                 <command>
-->

<!DOCTYPE videomonkey [
    <!ELEMENT videomonkey    (default_device|devices)*>
    <!ELEMENT script    (#PCDATA)>
    <!ELEMENT param    EMPTY>
        <!ATTLIST param id CDATA "">
        <!ATTLIST param value CDATA "">
	<!ELEMENT default_device    (quality|performance|script|param|command)*>
	<!ELEMENT common_device    (quality|performance|script|param|command)*>
    <!ELEMENT devices    (device_group*)>
    <!ELEMENT command    (#PCDATA)>
        <!ATTLIST command id CDATA "">
    <!ELEMENT quality    (quality_stop*)>
    <!ELEMENT quality_stop    (script|param|command)*>
        <!ATTLIST quality_stop title CDATA "">
        <!ATTLIST quality_stop bitrate CDATA "">
    <!ELEMENT performance    (performance_item*)>
    <!ELEMENT performance_item    (script|param|command)*>
        <!ATTLIST performance_item title CDATA "">
    <!ELEMENT device_group    (common_device?,device*)>
        <!ATTLIST device_group title CDATA "">
    <!ELEMENT device    (quality|performance|script|param|command|checkbox|menu)*>
        <!ATTLIST device title CDATA "">
        <!ATTLIST device icon CDATA "">
        <!ATTLIST device enabled CDATA "">
    <!ELEMENT checkbox    (checked_params|unchecked_params)*>
        <!ATTLIST checkbox which CDATA "">
        <!ATTLIST checkbox title CDATA "">
        <!ATTLIST checkbox enabled CDATA "">
     <!ELEMENT checked_params    (script|param|command)*>
    <!ELEMENT unchecked_params    (script|param|command)*>
    <!ELEMENT menu    (menu_item*)>
        <!ATTLIST menu which CDATA "">
        <!ATTLIST menu title CDATA "">
        <!ATTLIST menu enabled CDATA "">
     <!ELEMENT menu_item    (script|param|command)*>
        <!ATTLIST menu_item title CDATA "">
]>
<videomonkey>
    <default_device>
        <script>
            <![CDATA[
            
            function caseInsensitiveCompare(a,b) { return a.toLowerCase() == b.toLowerCase() }
            
            function audio(type)
            {
                params.audio_quality = type;
                switch(type) {
                    case "low":    params.audio_bitrate =  "16k"; params.audio_sample_rate = 11025; params.audio_channels = 1; break;
                    case "medium": params.audio_bitrate =  "32k"; params.audio_sample_rate = 22050; params.audio_channels = 1; break;
                    case "high":   params.audio_bitrate = "128k"; params.audio_sample_rate = 48000; params.audio_channels = 2; break;
                }
            }
            
			function bool(v)
			{
				if (typeof(v) == "number")
					return v != 0;
				if (typeof(v) == "boolean")
					return v;
				if (typeof(v) == "string")
					return v != "false" && v != "";
				return false;
			}
			
			function number(v)
			{
				if (typeof(v) == "number")
					return v;
				if (typeof(v) == "boolean")
					return v ? 1 : 0;
				if (typeof(v) == "string")
					return parseFloat(v);
				return 0;
			}
			
            function standardizeVideoCodecName(name)
            {
                if (caseInsensitiveCompare(name, "vc-1"))
                    return "wmv3";
                if (caseInsensitiveCompare(name, "avc") || caseInsensitiveCompare(name, "avc1"))
                    return "h.264";
                return name;
            }
            
			function adjustVideoParams()
			{
                params.special_qt = params.is_quicktime == "true" && params.input_video_codec == "wmv3";
            
	            // adjust video frame size
			    if (params.input_video_width == undefined)
                    var inputAspect = 4/3;
                else
	                var inputAspect = params.input_video_width / params.input_video_height;

                var requestedAspect = params.frame_width / params.frame_height;
                
	            if (inputAspect > requestedAspect) {
	                // shorten height
	                params.output_video_width = params.frame_width;
					params.output_video_height = params.frame_width / inputAspect;
				}
				else {
					// shorten width
					params.output_video_height = params.frame_height;
					params.output_video_width = params.frame_height * inputAspect;
				}
			
				// Make frame size divisible by 16
				params.output_video_width = Math.round(params.output_video_width / 16) * 16;
				params.output_video_height = Math.round(params.output_video_height / 16) * 16;
				
				// set frame rate
				params.output_frame_rate = params.input_frame_rate * params.frame_rate * 1000;
			}
			
			audio("high");
			
			adjustVideoParams();
           
            ]]>
        </script>
       	<quality>
             <quality_stop title="Tiny" />
            <quality_stop title="Low" />
            <quality_stop title="Standard" />
            <quality_stop title="High" />
        	<quality_stop title="Go Nuts" />
        </quality>
        <performance>
            <performance_item title="Fastest">
                <param id="is_2_pass" value="false" />
                <param id="ffmpeg_vpre" value="fastest" />
                <param id="ffmpeg_profile" value="-bf 1" />
            </performance_item>
            <performance_item title="Fast">
                <param id="is_2_pass" value="false" />
                <param id="ffmpeg_vpre" value="default" />
                <param id="ffmpeg_profile" value="-bf 1" />
            </performance_item>
            <performance_item title="Normal">
                <param id="is_2_pass" value="false" />
                <param id="ffmpeg_vpre" value="normal" />
                <param id="ffmpeg_profile" value="-bf 16" />
            </performance_item>
            <performance_item title="Normal (2 pass)">
              	<param id="is_2_pass" value="true" />
               	<param id="ffmpeg_vpre" value="normal" />
               	<param id="ffmpeg_vpre_pass1" value="normal-pass1" />
                <param id="ffmpeg_profile" value="-bf 16" />
             </performance_item>
            <performance_item title="High Quality">
                <param id="is_2_pass" value="false" />
                <param id="ffmpeg_vpre" value="hq" />
                <param id="ffmpeg_profile" value="-bf 16" />
            </performance_item>
            <performance_item title="High Quality (2 pass)">
                <param id="is_2_pass" value="true" />
                <param id="ffmpeg_vpre" value="hq" />
              	<param id="ffmpeg_vpre_pass1" value="hq-pass1" />
                <param id="ffmpeg_profile" value="-bf 16" />
           </performance_item>
        </performance>
        <param id="ffmpeg_vcodec" value="libx264" />
        <param id="ffmpeg_acodec" value="libfaac" />
    	<param id="video_suffix" value="mp4" />
	</default_device>
	
	<devices>
    
        <!--
        
            iTunes Group
            
        -->
        <device_group title="iTunes">
			<common_device>
		        <command id="ffmpeg_single_pass_options">
					-vpre $ffmpeg_vpre $ffmpeg_profile
				</command>
		        <command id="ffmpeg_pass1_options">
					-vpre $ffmpeg_vpre_pass1 -pass 1 -passlogfile "$pass_log_file" $ffmpeg_profile
				</command>
		        <command id="ffmpeg_pass2_options">
					-vpre $ffmpeg_vpre -pass 2 -passlogfile "$pass_log_file" $ffmpeg_profile
				</command>
		        <command id="ffmpeg_options">
		            -vcodec $ffmpeg_vcodec -b $bitrate -s $(output_video_width)x$(output_video_height) 
						-aspect $(output_video_width):$(output_video_height) -r $(output_frame_rate):1000
					-acodec $ffmpeg_acodec -ab $audio_bitrate -ar $audio_sample_rate -ac $audio_channels
				</command>
		        <command id="quicktime_to_audio_file">
					$qt_export "$input_file" --video=0 "$tmp_audio_file"
				</command>
	 	        <command id="correct_yuv">
					$yuvcorrect -v 0 -Y LUMINANCE_1.20_0_255_0_255 -Y CHROMINANCE_0_1.04_128_1.04_128_0_255
				</command>
		        <command id="quicktime_to_yuv">
					$movtoy4m -f -w $input_video_width -h $input_video_height -F $(output_frame_rate):1000 
						-a $(output_video_width):$(output_video_height) "$input_file" | $correct_yuv 
				</command>
		        <command id="yuv_to_ffmpeg_av"> $ffmpeg -y -i - -i "$tmp_audio_file" </command>
		        <command id="yuv_to_ffmpeg_v"> $ffmpeg -y -i - </command>
		        <command id="ffmpeg_normal"> $ffmpeg -y -i "$input_file" </command>
		        <command id="quicktime_av_single_pass">
					$quicktime_to_yuv | $yuv_to_ffmpeg_av $ffmpeg_options $ffmpeg_single_pass_options "$output_file"
				</command>
		        <command id="quicktime_av_pass1"> 
					$quicktime_to_yuv | $yuv_to_ffmpeg_av $ffmpeg_options $ffmpeg_pass1_options "$output_file" 
				</command>
		        <command id="quicktime_av_pass2">
					$quicktime_to_yuv | $yuv_to_ffmpeg_av $ffmpeg_options $ffmpeg_pass2_options "$output_file"
				</command>
		        <command id="quicktime_v_single_pass"> 
					$quicktime_to_yuv | $yuv_to_ffmpeg_v $ffmpeg_options $ffmpeg_single_pass_options "$output_file"
				</command>
		        <command id="quicktime_v_pass1">
					$quicktime_to_yuv | $yuv_to_ffmpeg_v $ffmpeg_options $ffmpeg_pass1_options "$output_file"
				</command>
		        <command id="quicktime_v_pass2">
					$quicktime_to_yuv | $yuv_to_ffmpeg_v $ffmpeg_options $ffmpeg_pass2_options "$output_file"
				</command>
		        <command id="normal_pass1">
					$ffmpeg_normal $ffmpeg_options $ffmpeg_pass1_options "$output_file"
				</command>
		        <command id="normal_pass2">
					$ffmpeg_normal $ffmpeg_options $ffmpeg_pass2_options "$output_file"
				</command>
		        <command id="normal_single_pass">
					$ffmpeg_normal $ffmpeg_options $ffmpeg_single_pass_options "$output_file"
				</command>
				<script>
	           		<![CDATA[
	
					// At this point, we know what 2 quality stops we are between (params.quality_stop and params.quality_stop+1)
					// and we know what percentage of the way between the two we are (params.quality). We also which device we have 
					// selected (params.title), whether we are doing h.264 or mpeg4 (params.h264), and whether we want to optimize 
					// for TV or iPod (params.for_tv). From this we need to compute params.frame_width, params.frame_height,
					// params.audio_quality and params.bitrate.
					
					// We support a number of standard frame sizes. After adjusting these sizes according to the flags
					// (h264, forTV), we determine the actual frame size using these as maximum values, taking
					// into account aspect ratio.
					
					var frameSizes = {
						"tiny":  [  192,  144 ],
						"small": [  320,  240 ],
						"iphone":[  480,  320 ],
						"sdef":  [  640,  480 ],
						"idef":  [ 1280,  720 ],
						"hdef":  [ 1920, 1080 ]
					};
					
					var deviceFrameSizeMap = {
						//								0			1			2			3			4
						"All Apple Devices": 	[	[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for iPod
												  	[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for TV
													[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// h.264 && for iPod
													[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ] ],	// h.264 && for TV
						"iPod": 				[ 	[ 	"tiny", 	"small", 	"small", 	"small", 	"small" ],  // mp4 && for iPod
												  	[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for TV
													[ 	"tiny",		"small", 	"small", 	"small", 	"small" ], 	// h.264 && for iPod
													[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ] ],	// h.264 && for TV
						"iPhone": 				[ 	[ 	"tiny", 	"small", 	"iphone", 	"iphone", 	"iphone" ], // mp4 && for iPod
												  	[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for TV
													[ 	"tiny",		"small", 	"iphone", 	"iphone", 	"iphone" ], // h.264 && for iPod
													[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ] ],	// h.264 && for TV
						"iPod touch": 			[ 	[ 	"tiny", 	"small", 	"iphone", 	"iphone", 	"iphone" ],	// mp4 && for iPod
												  	[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for TV
													[ 	"tiny",		"small", 	"iphone", 	"iphone", 	"iphone" ], // h.264 && for iPod
													[ 	"small",	"iphone", 	"sdef", 	"sdef", 	"sdef" ] ],	// h.264 && for TV
						"Apple TV": 			[ 	[ 	"sdef", 	"sdef", 	"sdef", 	"sdef", 	"sdef" ] 	// mp4 && for iPod
												  	[ 	"sdef",		"sdef", 	"sdef", 	"sdef", 	"sdef" ], 	// mp4 && for TV
													[ 	"idef",		"idef", 	"idef", 	"idef", 	"idef" ], 	// h.264 && for iPod
													[ 	"idef",		"idef", 	"idef", 	"idef", 	"idef" ] ]	// h.264 && for TV
					};
					
					var bitrateQualityMap = {
						//							mp4								       h.264
						"All Apple Devices": 	[ [ 300,  450,  600, 1000, 1800, 2500 ], [ 300,  450,  600, 1000, 1200, 1500 ] ], 
						"iPod": 				[ [ 300,  450,  300,  700, 1500, 2500 ], [ 300,  450,  300,  700, 1000, 1500 ] ], 
						"iPhone": 				[ [  60,  150,  300,  700, 1500, 2500 ], [  60,  150,  300,  700, 1000, 1500 ] ], 
						"iPod touch": 			[ [ 300,  450,  300,  700, 1500, 2500 ], [ 300,  450,  300,  700, 1000, 1500 ] ], 
						"Apple TV": 			[ [ 500, 1000, 1500, 2000, 2500, 3000 ], [ 500, 1000, 1500, 2500, 3750, 5000 ] ]
					};
					
					var audioQualityMap = {
						//							0			1			2			3			4
						"All Apple Devices": 	[ 	"low", 		"high", 	"high", 	"high", 	"high" ],
						"iPod": 				[ 	"low", 		"high", 	"high", 	"high", 	"high" ],
						"iPhone": 				[ 	"low", 		"medium", 	"high", 	"high", 	"high" ],
						"iPod touch": 			[ 	"low", 		"high", 	"high", 	"high", 	"high" ],
						"Apple TV": 			[ 	"high", 	"high", 	"high", 	"high", 	"high" ]
					};
					
					var title = params.title;
					var qualityStop = number(params.quality_stop);
					var quality = number(params.quality);
					var h264 = bool(params.h264);
					var forTV = bool(params.forTV);
					
					// set frame size
					var index = (h264 ? 2 : 0) + (forTV ? 1 : 0);
					var sizeString = deviceFrameSizeMap[title][index][qualityStop];
					params.frame_width = frameSizes[sizeString][0];
					params.frame_height = frameSizes[sizeString][1];
					adjustVideoParams();
					
					// set bitrate
					var bitrateMin = bitrateQualityMap[title][h264 ? 1 : 0][qualityStop] * 1000;
					var bitrateMax = bitrateQualityMap[title][h264 ? 1 : 0][qualityStop+1] * 1000;
					params.bitrate = (bitrateMax - bitrateMin) * quality + bitrateMin;
					
					// set audio quality
               		params.audio_quality = audioQualityMap[title][qualityStop];
               		switch(params.audio_quality) {
                   		case "low":    params.audio_bitrate =  "16k"; params.audio_sample_rate = 11025; params.audio_channels = 1; break;
                   		case "medium": params.audio_bitrate =  "32k"; params.audio_sample_rate = 22050; params.audio_channels = 1; break;
                   		case "high":   params.audio_bitrate = "128k"; params.audio_sample_rate = 48000; params.audio_channels = 2; break;
               		}
               		
               		// set the frame rate
               		params.frame_rate = 1;
               		if (title != "Apple TV" && qualityStop == 0)
               		    params.frame_rate = 0.5;

					// set endoder
					params.ffmpeg_vcodec = h264 ? "libx264" : "mpeg4";

					// adjust vpre for baseline if needed
					if (title != "Apple TV")
						params.ffmpeg_profile = "-bf 0 -coder 0 -flags2 -wpred-dct8x8";

					// construct the recipe
					if (	 !bool(params.special_qt) && !bool(params.has_audio) && !bool(params.is_2_pass))
		            	params.recipe = "$normal_single_pass";
					else if (!bool(params.special_qt) && !bool(params.has_audio) && bool(params.is_2_pass))
			            params.recipe = "$normal_pass1 ; $normal_pass2";
					else if (!bool(params.special_qt) && bool(params.has_audio) && !bool(params.is_2_pass))
				        params.recipe = "$normal_single_pass";
					else if (!bool(params.special_qt) && bool(params.has_audio) && bool(params.is_2_pass))
						params.recipe = "$normal_pass1 ; $normal_pass2";
					else if (bool(params.special_qt) && !bool(params.has_audio) && !bool(params.is_2_pass))
						params.recipe = "$quicktime_v_single_pass";
					else if (bool(params.special_qt) && !bool(params.has_audio) && bool(params.is_2_pass))
						params.recipe = "$quicktime_v_pass1 ; $quicktime_v_pass2";
					else if (bool(params.special_qt) && bool(params.has_audio) && !bool(params.is_2_pass))
						params.recipe = "$quicktime_to_audio_file ; $quicktime_av_single_pass";
					else if (bool(params.special_qt) && bool(params.has_audio) && bool(params.is_2_pass))
						params.recipe = "$quicktime_to_audio_file ; $quicktime_av_pass1 ; $quicktime_av_pass2";

		            ]]>
		        </script>
 			</common_device>
           	<!-- All Apple Devices -->
            <device title="All Apple Devices" icon="itunesfile">
                 <checkbox which="0" title="H.264 Video">
                    <checked_params>
                       	<param id="h264" value="true" />
                    </checked_params>
                    <unchecked_params>
                    	<param id="h264" value="true" />
                    </unchecked_params>
                </checkbox>
			</device>
            
            <!-- iPod -->
            <device title="iPod" icon="ipod">
            	<checkbox which="0" title="H.264 Video">
                    <checked_params>
                       	<param id="h264" value="true" />
                    </checked_params>
                    <unchecked_params>
                    	<param id="h264" value="true" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                	<menu_item title="iPod Screen">
                       	<param id="forTV" value="false" />
                    </menu_item>
                    <menu_item title="TV Screen">
                       	<param id="forTV" value="true" />
                   	</menu_item>
                </menu>
            </device>
            
            <!-- iPhone -->
            <device title="iPhone" icon="iphone">
            	<quality>
                    <quality_stop title="EDGE" />
 					<quality_stop title="3G" />
                	<quality_stop title="WiFi" />
               		<quality_stop title="High" />
                 	<quality_stop title="Go Nuts" />
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                       	<param id="h264" value="true" />
                    </checked_params>
                    <unchecked_params>
                    	<param id="h264" value="true" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                	<menu_item title="iPod Screen">
                       	<param id="forTV" value="false" />
                    </menu_item>
                    <menu_item title="TV Screen">
                       	<param id="forTV" value="true" />
                   	</menu_item>
                </menu>
            </device>
            
            <!-- iPod touch -->
            <device title="iPod touch" icon="iphone">
               	<quality>
                    <quality_stop title="Tiny" />
               		<quality_stop title="Low" />
                    <quality_stop title="WiFi" />
                    <quality_stop title="High" />
                    <quality_stop title="Go Nuts" />
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                       	<param id="h264" value="true" />
                    </checked_params>
                    <unchecked_params>
                    	<param id="h264" value="true" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                	<menu_item title="iPod Screen">
                       	<param id="forTV" value="false" />
                    </menu_item>
                    <menu_item title="TV Screen">
                       	<param id="forTV" value="true" />
                   	</menu_item>
                </menu>
             </device>
            
            <!-- Apple TV -->
            <device title="Apple TV" icon="appletv">
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                       	<param id="h264" value="true" />
                    </checked_params>
                    <unchecked_params>
                    	<param id="h264" value="true" />
                    </unchecked_params>
                </checkbox>
				<checkbox which="1" title="Keep Surround Track" enabled="false">
                    <checked_params>
                        <param id="keep_surround_track" value="true" />
                    </checked_params>
                    <unchecked_params>
                        <param id="keep_surround_track" value="false" />
                    </unchecked_params>
                </checkbox>
 			</device>
         </device_group>


        <!--
        
            Video Devices Group
            
        -->
        <device_group title="Video Devices">
            <!-- DV -->
            <device title="DV" icon="dv" enabled="false">
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
            </device>
            
            <!-- DVD -->
            <device title="DVD" icon="cd" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- Tivo Series 2 -->
            <device title="Tivo Series 2" icon="tivo" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- Tivo Series 3 -->
            <device title="Tivo Series 3" icon="tivo" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>

            <!-- 3g Cell Phones -->
            <device title="3g Cell Phones" icon="3g" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
        </device_group>


        <!--
        
            Game Systems Group
            
        -->
        <device_group title="Game Systems">
            <!-- XBox 360 -->
            <device title="XBox 360" icon="xbox360" enabled="false">
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
            </device>
            
            <!-- PSP -->
            <device title="PSP" icon="psp" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- Playstation 3 -->
            <device title="Playstation 3" icon="ps3" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- Nintendo Wii -->
            <device title="Nintendo Wii" icon="wii" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
        </device_group>


        <!--
        
            Generic Formats Group
            
        -->
        <device_group title="Generic Formats">
            <!-- AVI -->
            <device title="AVI" icon="file" enabled="false">
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
            </device>
            
            <!-- MP4 -->
            <device title="MP4" icon="file" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- QuickTime -->
            <device title="QuickTime" icon="file" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- WMV -->
            <device title="WMV" icon="wma" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>

            <!-- Flash -->
            <device title="Flash" icon="flash" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
            
            <!-- MPEG -->
            <device title="MPEG" icon="file" enabled="false">
                <quality>
                    <quality_stop title="EDGE" bitrate="50000">
                        <script> audio('low') </script> 
                        <param id="size" value="192x144" />
                        <param id="frame_rate" value="0.5" />
                    </quality_stop>
                    <quality_stop title="3G" bitrate="100000">
                        <script> audio('medium') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="WiFi" bitrate="1100000">
                        <script> audio('high') </script> 
                        <param id="size" value="480x320" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="High" bitrate="1800000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                    <quality_stop title="Go Nuts" bitrate="3000000">
                        <script> audio('high') </script> 
                        <param id="size" value="640x480" />
                        <param id="frame_rate" value="1" />
                    </quality_stop>
                </quality>
                <checkbox which="0" title="H.264 Video">
                    <checked_params>
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </checked_params>
                    <unchecked_params>
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </unchecked_params>
                </checkbox>
                <menu which="0" title="Best for:">
                    <menu_item title="iPhone Screen">
                        <param id="ffmpeg_vcodec" value="libx264" />
                    </menu_item>
                    <menu_item title="TV Screen">
                        <param id="ffmpeg_vcodec" value="mpeg4" />
                    </menu_item>
                </menu>
            </device>
        </device_group>
    </devices>
</videomonkey>

        